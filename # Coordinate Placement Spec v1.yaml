spec_name: "Coordinate Placement Spec v1"
status: "stable"
context: "Adobe Illustrator diagram generation"
authoritative_source: "illustrator_document"
grid_unit_pt: 3.25
epsilon: 0.01

coordinate_system:
  type: "cell-based"
  description: "Spatial placement uses a cell grid defined by guides. Cells are the spaces between guides, referenced like spreadsheet coordinates."

  cell_notation:
    columns: "A, B, C, ... (left → right, derived from vertical guides)"
    rows: "1, 2, 3, ... (top → bottom, derived from horizontal guides)"
    single_cell: "E2 (column E, row 2)"
    cell_range: "D4:F7 (spans columns D–F, rows 4–7)"

  guides:
    description: "Guides define cell boundaries. The space between GUIDE_xA and GUIDE_xB is column A; space between GUIDE_y1 and GUIDE_y2 is row 1."
    naming:
      vertical: "GUIDE_xA, GUIDE_xB, ... (define column boundaries)"
      horizontal: "GUIDE_y1, GUIDE_y2, ... (define row boundaries)"
    properties:
      - "Guides are invisible in export."
      - "Guides MUST snap to the document grid."
      - "Cells (spaces between guides) define legal placement zones."
      - "Guides are not placeable semantic objects."

grid_and_snapping:
  rules:
    - "All placed objects MUST align to the grid within ±epsilon."
    - "All guide positions MUST align to the grid."
  validation_checks:
    - "left"
    - "top"
    - "composite bounds"

semantic_prefix_taxonomy:
  prefixes:
    GUIDE: "Coordinate infrastructure (guides only)"
    ICON: "Atomic symbolic assets"
    COMP: "Composite functional units (grouped, placed as one)"
    AREA: "Space-occupying elements (zones, furniture, storage)"
    BOUND: "Boundary / delineation geometry"
    LABEL: "Meta indicators / annotations"
    SHAPE: "Non-semantic geometry (discouraged)"
  naming_rules:
    - "Every semantic object MUST have a name."
    - "Suffix policy by prefix: LABEL_* uses alphabetical suffixes (__A, __B, __C, ...); all other semantic prefixes use numeric suffixes (__001, __002, ...)."
    - "Numbered instances are interchangeable unless grouped."
    - "Unknown prefixes FAIL validation."

placement_authority:
  composites:
    rules:
      - "COMP_* objects are placement authorities."
      - "Child elements of a COMP_* are positioned relative to the parent."
      - "Child elements MUST NOT be individually placed or snapped."
  area_objects:
    rules:
      - "AREA_* objects represent space occupation (furniture, zones, storage, footprints)."
      - "AREA_* objects are placed independently."
      - "AREA_* objects do NOT generate contents."
  boundary_objects:
    rules:
      - "BOUND_* objects define boundaries only."
      - "BOUND_* objects do NOT occupy space."
      - "BOUND_* objects do NOT contain other objects."

placement_semantics:
  anchor_types:
    cell_placement:
      schema: "{ cell: 'A1' }"
      meaning: "Object is placed within the specified cell."
      anchor_default: "top-left corner of cell, snapped to grid"
      example: "{ \"cell\": \"E2\" }"
    cell_range:
      schema: "{ cell: 'A1:C3' }"
      meaning: "Object spans multiple cells (like Excel range notation)."
      example: "{ \"cell\": \"D4:F7\" }"
    cell_with_offset:
      schema: "{ cell: 'A1', dx: number_pt, dy: number_pt }"
      constraints:
        - "dx and dy MUST be grid-aligned."
      example: "{ \"cell\": \"E2\", \"dx\": 6.5, \"dy\": 3.25 }"
    cell_anchor_point:
      schema: "{ cell: 'A1', anchor: 'center' }"
      anchor_options: ["top-left", "top-right", "bottom-left", "bottom-right", "center"]
      example: "{ \"cell\": \"E2\", \"anchor\": \"center\" }"

multiple_objects_and_layout_logic:
  rules:
    - "No global flow direction exists."
    - "Placement patterns (rows, columns, stacks, symmetry) are inferred from example images and expressed as coordinate rules."
    - "Even distribution is preferred unless example dictates otherwise."
    - "Overlaps are allowed unless explicitly forbidden."

missing_semantic_assets:
  when_missing:
    action: "Insert placeholder"
    placeholder:
      shape: "circle"
      color: "magenta"
      size_pt: [16, 16]
      grid_aligned: true
    rules:
      - "Placeholder MUST be named."
      - "Placeholder acts as a semantic stand-in."

capacity_and_failure:
  rules:
    - "If placement exceeds intended capacity: generation MUST stop and a warning MUST be issued."
    - "Silent overflow is not allowed."

example_images_and_llm_interpretation:
  interpretation_phase:
    allowed:
      - "infer alignments, clusters, axes"
      - "map visible elements to semantic types"
      - "emit coordinate-based placement rules"
  conflict_resolution:
    rules:
      - "If inferred rules conflict with this spec: user MUST be prompted to choose precedence."
      - "No automatic override is allowed."
  persistence:
    rules:
      - "Accepted interpretations MAY be saved as reusable layout profiles."

validation_rules:
  must_enforce:
    - "all semantic objects are named"
    - "prefixes are valid"
    - "placement is grid-aligned"
    - "composites are treated atomically"
    - "guides are not treated as placeable objects"
  authority: "Validation output is authoritative."

authority_model:
  rules:
    - "Illustrator document = source of truth"
    - "Exports (JSON, CSV, reports) = snapshots"
    - "Manual edits are allowed and treated as corrective"
    - "Validation determines system consistency"

end_of_spec: true
